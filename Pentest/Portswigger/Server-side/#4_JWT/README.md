# What are JWTs?

- WTs (JSON Web Tokens) là một định dạng tiêu chuẩn để gửi dữ liệu dưới dạng JSON đã được ký điện tử giữa các hệ thống.Theo lý thuyết, chúng có thể chứa bất kỳ loại dữ liệu nào, nhưng thường được sử dụng để gửi thông tin ("claims") về người dùng như một phần của cơ chế xác thực, quản lý phiên, và kiểm soát truy cập.

- Không giống như các `classic session tokens`, tất cả dữ liệu mà máy chủ cần được lưu trữ trên máy khách bên trong JWT. Điều này làm cho JWTs trở thành một lựa chọn phổ biến cho các trang web phân tán nơi người dùng cần tương tác một cách mượt mà với nhiều máy chủ phía sau.

# JWT format

- JWT bao gồm 3 phần: `header`, `payload` và `signature`, mỗi phần sẽ ngăn cách bởi dấu `.`

```console
eyJraWQiOiI5MTM2ZGRiMy1jYjBhLTRhMTktYTA3ZS1lYWRmNWE0NGM4YjUiLCJhbGciOiJSUzI1NiJ9.eyJpc3MiOiJwb3J0c3dpZ2dlciIsImV4cCI6MTY0ODAzNzE2NCwibmFtZSI6IkNhcmxvcyBNb250b3lhIiwic3ViIjoiY2FybG9zIiwicm9sZSI6ImJsb2dfYXV0aG9yIiwiZW1haWwiOiJjYXJsb3NAY2FybG9zLW1vbnRveWEubmV0IiwiaWF0IjoxNTE2MjM5MDIyfQ.SYZBPIBg2CRjXAJ8vCER0LA_ENjII1JakvNQoP-Hw6GG1zfl4JyngsZReIfqRvIAEi5L4HV0q7_9qGhQZvy9ZdxEJbwTxRs_6Lb-fZTDpW6lKYNdMyjw45_alSCZ1fypsMWz_2mTpQzil0lOtps5Ei_z7mM7M8gCwe_AGpI53JxduQOaB5HkT5gVrv9cKu9CsW5MS6ZbqYXpGyOG5ehoxqm8DL5tFYaW3lB50ELxi0KsuTKEbD0t5BCl0aCR2MBJWAbN-xeLwEenaqBiwPVvKixYleeDQiBEIylFdNNIMviKRgXiYuAvMziVPbwSgkZVHeEdF5MQP1Oe2Spac-6IfA
```

- Phần `header` cũng như `payload` sẽ chỉ sử dụng `base64url-encoded JSON`

Ở phần `header` sẽ chứa các thông tin token về chính nó

Phần `payload` thì sẽ hiểm thị các thông tin của người dùng

Ta có thể giải mã JWT phía trên như sau:

```console
{
    "iss": "portswigger",
    "exp": 1648037164,
    "name": "Carlos Montoya",
    "sub": "carlos",
    "role": "blog_author",
    "email": "carlos@carlos-montoya.net",
    "iat": 1516239022
}
```

- Vì 2 phần `header` cũng như `payload` này rất dễ đọc nên tính bảo mật của JWT sẽ phụ thuộc vào phần `signature`

# JWT signature

- Bên phía sever sẽ đưa ra token bằng cách `hash` header và payload. Trong một vài trường hợp thì sẽ `encrypt` `kết quả sau khi hash`. Cho dù bằng cách nào đi nữa, quá trình này cũng đều liên quan đến 1 `secret key`. Cơ chế này cũng cấp cho máy chủ 1 cách kiểm tra xem có dữ liệu nào trong token bị thay đổi từ khi nó được phát hành hay không

- Do `signature` được tạo ra từ phần còn lại của token, việc thay đổi một byte duy nhất trong phần header hoặc payload sẽ dần đến một chữ ký bị sai. Mà ta cũng không biết được secret key nên cũng không thể tạo ra 1 signature chính xác 


