# Lab: Password reset poisoning via middleware

# 1. Vulnerable

Ở bài lab này có chức nằng quên mật khẩu

Trang web sẽ gửi đến email của người dùng link đổi mật khẩu có chứa token để đổi mật khẩu

# 2. Exploit

Đầu tiên ta sẽ gửi yêu cầu reset mật khẩu ở chính tài khoản cá nhân và email nhận được có dạng như sau

![vuln0.png](/images/vuln0.png)

Đây là request lên sever để yêu cầu đổi mật khẩu

![vuln1.png](/images/vuln1.png)

Do ở email sẽ gửi cho ta 1 link 

![vuln2.png](/images/vuln2.png)

Cho ta thấy yêu cầu reset mật khẩu được chuyển tiếp từ `link` -> `sever` -> `user's email`

Nếu ta fake yêu cầu reset bằng `X-Forwarded-Host`

![vuln3.png](/images/vuln3.png)

Ta sẽ nhận được email là 

![vuln4.png](/images/vuln4.png)

Lợi dụng điều này bằng trang `exploit` có file log của ta và đánh cắp `token` của `victim`

![vuln5.png](/images/vuln5.png)

Sau khi `carlos` nhấn vào link và truy cập vào trang web exploit thì ta đã có log đi kèm với `token`

-> Đổi mật khẩu bằng token

![vuln6.png](/images/vuln6.png)

Đăng nhập vào bằng mật khẩu đã đổi và solved!

![solved.png](/images/solved.png)